{% extends "profesor/base.html" %}
{% load static %}
{% load get_item %}

{% block title %}Mi Horario{% endblock %}

{% block content %}
<h2 class="text-center mb-4">
    <i class="bi bi-calendar-week me-2"></i>Mi Horario Académico
</h2>

<style>
    table.horario {
        width: 100%;
        border-collapse: collapse;
        text-align: center;
        table-layout: fixed;
    }
    .horario thead th {
        background: #0d6efd;
        color: white;
        padding: 10px;
    }
    .horario td, .horario th {
        border: 1px solid #ccc;
        padding: 6px;
        vertical-align: top;
        min-height: 60px;
    }
    .slot {
        background: #e7f1ff;
        border-left: 4px solid #0d6efd;
        border-radius: 4px;
        padding: 6px;
        font-size: 0.84rem;
        margin-bottom: 4px;
        display: block;
    }
    .slot strong {
        display: block;
    }
</style>

<table class="horario">
    <thead>
        <tr>
            <th style="width: 100px;">Hora</th>
            {% for dia, nombre in dias.items %}
            <th>{{ nombre }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for hour in horas %}
        <tr>
            <td><strong>{{ hour }}</strong></td>

            {% for dia in dias.keys %}
            <td>
                {% with horarios_dia=tabla_horarios|get_item:dia %}
                {% if horarios_dia %}
                    {% for h in horarios_dia %}
                        {# Mostrar si el horario intersecta con esta hora #}
                        {% with hora_actual_int=hour|slice:":2"|add:"0" %}
                        {% with inicio_int=h.hora_inicio|time:"H"|add:"0" %}
                        {% with fin_int=h.hora_fin|time:"H"|add:"0" %}
                        {% if inicio_int <= hora_actual_int and fin_int > hora_actual_int %}
                        <span class="slot">
                            <strong>{{ h.curso.nombre|truncatechars:25 }}</strong>
                            Aula: {{ h.ubicacion.nombre }}<br>
                            {{ h.get_tipo_clase_display }} • Grupo {{ h.grupo }}<br>
                            {{ h.hora_inicio|time:"H:i" }} - {{ h.hora_fin|time:"H:i" }}
                        </span>
                        {% endif %}
                        {% endwith %}
                        {% endwith %}
                        {% endwith %}
                    {% endfor %}
                {% endif %}
                {% endwith %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
